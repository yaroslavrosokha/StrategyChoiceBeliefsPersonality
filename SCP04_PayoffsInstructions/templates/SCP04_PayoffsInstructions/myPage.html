{% extends "global/Page.html" %}
{% load staticfiles otree %}

{% block app_styles %}

<style type="text/css">

:root {
    --C-color: #f9ff87;
    --D-color: #8ec9ff;
    --cell-width: 50px;
    --cell-height: 35px;
    --line-height-small: 30px;
    --line-height-regular: 45px;
    --label-width: 150px;
    --line1-top: 0px;
    --line2-top: 35px;
    --line3-top: 70px;
    --line4-top: 120px;
    --line5-top: 170px;
    --line6-top: 205px;
    --inner-container-height: 260px;
}

.row {
    display: flex;
}

/* Create two equal columns that sits next to each other */
.column {
    flex: 50%;
    padding: 20px 50px 0px 50px;
}

table {
    table-layout: fixed;
    width: 95%;
    left: 2.5%;
    line-height: 1.15;
    vertical-align: middle;
}

th {
    height: 50px;
    vertical-align: middle;
}


tr{
    border: none;
    background-color: white;
    vertical-align: middle;
}



.otree-body {

    font-family: Proxima Nova;
    font-size: 18px;
    position: absolute;
    width: 1678px;
    height: 1048px;
    max-width: 1678px;
    max-height: 1048px;
    border: solid darkgreen;
}

.otree-title {
    background: white;
    font-family: Proxima Nova;
    text-align: center;
}

.otree-title.page-header {
    font-family: Proxima Nova;
    text-align: center;
    padding: 0px;
}

.card-body {
    background: white;
    font-family: Proxima Nova;
    font-size: 18px;
}

.card.bg-light.instructions{
    padding: 0;
    border: none;
}

.outerbox
{
   width:100%; /* or whatever width you want. */
   height: 280px;
   max-width:100%; /* or whatever width you want. */
   position: relative;
   background: white;
   {#top:100px;#}
   {#left:0px;#}
   overflow-x: hidden;
   overflow-y: hidden;
}


.innerbox
{
   width:550px; /* or whatever width you want. */
   height: var(--inner-container-height);
   max-width:550px; /* or whatever width you want. */
   position: absolute;
   background: white;
   top:0px;
   left:150px;
   overflow-x: hidden;
   overflow-y: hidden;
}

.payoffbox
{
   width:460px; /* or whatever width you want. */
   height: 200px;
   max-width:460px; /* or whatever width you want. */
   position: relative;
   background: white;
   top:0px;
   left:170px;
   overflow-x: hidden;
   overflow-y: hidden;
}

.payoffDetail {
    left:var(--label-width);
    width:var(--cell-width);
    height:var(--cell-width);
    background: white;
    border-style: solid;
    border-width: thin;
    position: absolute;

    text-align: center;
    line-height: var(--line-height-regular);
    padding-bottom: 5px;
}


.randomNumLabel {
    top:var(--line1-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: -webkit-sticky;
    position: sticky;
    opacity: .5;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
    font-size: 12px;
}
.randomNum {
    left:0px;
    top:var(--line1-top);
    width:15px;
    background: white;
    border-style: none;
    position: absolute;
    opacity: .5;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    font-size: 12px;

    opacity: 0;
    animation: fadeIn5 .25s;
    animation-delay: 1.2s;
    animation-fill-mode: forwards;
}

.periodLabel {
    top:var(--line2-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: -webkit-sticky;
    position: sticky;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
}
.period {
    {#left:0px;#}
    top:var(--line2-top);
    width:var(--cell-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: absolute;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}

    {#opacity: 0;#}
    animation: fadeIn .25s;
    animation-delay: .15s;
    animation-fill-mode: forwards;

	-webkit-animation-fill-mode: forwards;
	-moz-animation-fill-mode: forwards;
	-o-animation-fill-mode: forwards;
	animation-fill-mode: forwards;

}


.myChoiceLabel {
    top:var(--line3-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-width);
    background: white;
    border-style: solid;
    border-width: thin;
    position: -webkit-sticky;
    position: sticky;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-regular);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
}
.myChoice {
    left:0px;
    top:var(--line3-top);
    width:var(--cell-width);
    height:var(--cell-width);
    background: white;
    border-style: solid;
    border-width: thin;
    position: absolute;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-regular);
    padding-bottom: 5px;
    {#font-size: 35px;#}

    opacity: 0;
    animation: fadeIn .25s;
    animation-delay: .15s;
    animation-fill-mode: forwards;
}



.otherChoiceLabel {
    top:var(--line4-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-width);
    background: white;
    border-style: solid;
    border-width: thin;
    position: -webkit-sticky;
    position: sticky;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-regular);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
}
.otherChoice {
    left:0px;
    top:var(--line4-top);
    width:var(--cell-width);
    height:var(--cell-width);
    background: white;
    border-style: solid;
    border-width: thin;
    position: absolute;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-regular);
    padding-bottom: 5px;
    {#font-size: 35px;#}

    opacity: 0;
    animation: fadeIn .25s;
    animation-delay: .15s;
    animation-fill-mode: forwards;
}


.myPayoffLabel {
    top:var(--line5-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: -webkit-sticky;
    position: sticky;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
}
.myPayoff {
    left:0px;
    top:var(--line5-top);
    width:var(--cell-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: absolute;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}

    opacity: 0;
    animation: fadeIn .25s;
    animation-delay: .15s;
    animation-fill-mode: forwards;
}

.otherPayoffLabel {
    top:var(--line6-top);
    left:0px;
    width:var(--label-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: -webkit-sticky;
    position: sticky;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}
    z-index: 2;
}
.otherPayoff {
    left:0px;
    top:var(--line6-top);
    width:var(--cell-width);
    height:var(--cell-height);
    background: white;
    border-style: none;
    position: absolute;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    padding-bottom: 5px;
    {#font-size: 35px;#}

    opacity: 0;
    animation: fadeIn .25s;
    animation-delay: .15s;
    animation-fill-mode: forwards;
    animation-timing-function: linear,ease;
}

.scrollLabel {
    top:var(--line7-top);
    left:0px;
    width:var(--label-width);
    height:20px;
    background: white;
    border-style: none;
    position: -webkit-sticky;
    position: sticky;
    opacity: .5;
    {#top:10px;#}
    {#left:10px;#}
    text-align: center;
    line-height: var(--line-height-small);
    {#font-size: 35px;#}
    z-index: 2;
    font-size: 12px;
    vertical-align: middle;
    display: none;
}


@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeIn5 {
    from { opacity: 0; }
    to { opacity: .5; }
}


</style>

{% endblock %}




{% block app_scripts %}

<script>
        var MyVariables = {chosen1:-1,chosen2:-1,period:0,myNumbers:[1,2,3],payoffMatrix:[[{{ R|json }},12],[50,25]],myChoice:-1,otherChoice:-1,match:1,myTotal:0,otherTotal:0};

document.addEventListener('keydown', function(event) {
  if ((event.code == 'KeyR' || event.code == 'KeyF' || event.code == 'KeyS')  && (event.ctrlKey || event.metaKey)) {
    event.preventDefault();
  }

  if ((event.code == 'F5')) {
    event.preventDefault();
  }

    if ((event.code == 'Tab')) {
    event.preventDefault();
  }

  if ((event.code == 'ArrowLeft' || event.code == 'ArrowRight') && (event.code=='AltLeft' || event.code=='altRight' || event.altKey || event.metaKey) ) {
    event.preventDefault();
  }
});


        function startMatch() {


            resetGame();

            MyVariables.myChoice=-1;
            MyVariables.otherChoice=-1;
            MyVariables.period=1;
            MyVariables.myTotal=0;
            MyVariables.otherTotal=0;

            hide("matchSummary");
            enableButton("myChoice" + 'A');
            enableButton("myChoice" + 'B');
            enableButton("otherChoice" + 'A');
            enableButton("otherChoice" + 'B');
            updateText("myChoiceRound", MyVariables.period.toFixed(0));
            updateText("otherChoiceRound", MyVariables.period.toFixed(0));

            {#hide("Information1");#}
            {#hide("Information2");#}
            {#hide("Information3");#}
            hide("startMatchButton");

            showFlex("ManualChoices");

            //Period
            var p = MyVariables.period;
            var per = document.createElement('div');
            per.className = 'period';
            per.id = 'id_period_' + p.toFixed(0);
            per.innerHTML = p.toFixed(0);
            per.style.backgroundColor = 'white';
            per.style.left = (50 * (1 - p)).toFixed(0) + "px";
            document.getElementById("id_innerbox").appendChild(per);

            var per = document.createElement('div');
            per.className = 'randomNum';
            per.id = 'id_randomNum_' + p.toFixed(0);
            per.style.left = (50 * (1 - p)).toFixed(0) + "px";
            per.innerHTML="";
            document.getElementById("id_innerbox").appendChild(per);

            disableButton("diceRollButton");

        }

        function rollDice() {

            var p = MyVariables.period;
            var randomItem = 1 + Math.floor(Math.random() * 4);

            var per = document.getElementById('id_randomNum_' + p.toFixed(0));

            if (randomItem < 4) {
                per.innerHTML = randomItem;
                MyVariables.period++;
                enableButton("myChoice" + 'A');
                enableButton("myChoice" + 'B');
                enableButton("otherChoice" + 'A');
                enableButton("otherChoice" + 'B');
                MyVariables.myChoice = -1;
                MyVariables.otherChoice = -1;

                var p = MyVariables.period;
                var per = document.createElement('div');
                per.className = 'period';
                per.id = 'id_period_' + p.toFixed(0);
                per.innerHTML = p.toFixed(0);
                per.style.backgroundColor = 'white';
                per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                document.getElementById("id_innerbox").appendChild(per);

                var per = document.createElement('div');
                per.className = 'randomNum';
                per.id = 'id_randomNum_' + p.toFixed(0);
                per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                per.innerHTML = "";
                document.getElementById("id_innerbox").appendChild(per);

                updateText("myChoiceRound", MyVariables.period.toFixed(0));
                updateText("otherChoiceRound", MyVariables.period.toFixed(0));


            } else {
                per.style.fontWeight = "bold";
                per.style.color = "red";
                per.innerHTML = 4;
                per.style.opacity = 0;
                MyVariables.myChoice = -1;
                MyVariables.otherChoice = -1;

                hide("ManualChoices");

                show("matchSummary");
                updateText("summaryRounds", MyVariables.period.toFixed(0));
                updateText("summaryMyPayoff", MyVariables.myTotal.toFixed(0));
                updateText("summaryOtherPayoff", MyVariables.otherTotal.toFixed(0));

                MyVariables.match++;



                if(MyVariables.period>11){
                    enableScroll("id_innerbox");
                    show("scrollLabel");
                }


                    showInline("NextButton");

            }


            var names = ['id_randomNum_', 'id_period_', 'id_myChoice_', 'id_otherChoice_', 'id_myPayoff_', 'id_otherPayoff_'];


            for (var p = 1; p <= MyVariables.period - 1; p++) {
                for (var i = 0; i < names.length; i++) {
                    var x = document.getElementById(names[i] + p.toFixed(0));
                    x.style.left = (50 * (MyVariables.period - p)).toFixed(0) + "px";
                }
            }

            hide("diceRollButton");
            disableButton("diceRollButton");
        }

        function simulateRound(player,action) {
            console.log("period:",MyVariables.period,"player:", player, "action:", action);
            var options = ['A', 'B'];
            var colOptions = ['var(--C-color)', 'var(--D-color)'];

            if (player == "myChoice") {
                if (MyVariables.myChoice == -1) {
                    MyVariables.myChoice = action;

                    var x = document.getElementById(player + options[action]);

                    var tempElem = document.getElementById('id_myTestingHistory');
                    tempElem.value = tempElem.value + options[action];

                    disableButton(player + 'A');
                    disableButton(player + 'B');
                    x.style.borderColor = "black";

                    var p = MyVariables.period;
                    var per = document.createElement('div');
                    per.className = 'myChoice';
                    per.id = 'id_myChoice_' + p.toFixed(0);
                    per.innerHTML = options[action];
                    per.style.backgroundColor = colOptions[action];
                    per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                    document.getElementById("id_innerbox").appendChild(per);

                    if (MyVariables.otherChoice != -1) {
                        //my Payoff
                        var myPayoff = MyVariables.payoffMatrix[MyVariables.myChoice][MyVariables.otherChoice];
                        MyVariables.myTotal+=myPayoff;
                        var per = document.createElement('div');
                        per.className = 'myPayoff';
                        per.id = 'id_myPayoff_' + p.toFixed(0);
                        per.innerHTML = myPayoff.toFixed(0);
                        {#per.style.backgroundColor = 'var(--D-color)';#}
                        per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                        document.getElementById("id_innerbox").appendChild(per);


                        //Others Payoff
                        var otherPayoff = MyVariables.payoffMatrix[MyVariables.otherChoice][MyVariables.myChoice];
                        MyVariables.otherTotal+=otherPayoff;
                        var per = document.createElement('div');
                        per.className = 'otherPayoff';
                        per.id = 'id_otherPayoff_' + p.toFixed(0);
                        per.innerHTML = otherPayoff.toFixed(0);
                        {#per.style.backgroundColor = 'var(--D-color)';#}
                        per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                        document.getElementById("id_innerbox").appendChild(per);

                        show("diceRollButton");
                        enableButton("diceRollButton");

                    }

                }
            } else {
                if (MyVariables.otherChoice == -1) {
                    MyVariables.otherChoice = action;
                    var x = document.getElementById(player + options[action]);
                    disableButton(player + 'A');
                    disableButton(player + 'B');
                    x.style.borderColor = "black";

                    var tempElem = document.getElementById('id_otherTestingHistory');
                    tempElem.value = tempElem.value + options[action];

                    var p = MyVariables.period;
                    var per = document.createElement('div');
                    per.className = 'otherChoice';
                    per.id = 'id_otherChoice_' + p.toFixed(0);
                    per.innerHTML = options[action];
                    per.style.backgroundColor = colOptions[action];
                    per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                    document.getElementById("id_innerbox").appendChild(per);

                    if (MyVariables.myChoice != -1) {
                        //my Payoff
                        var myPayoff = MyVariables.payoffMatrix[MyVariables.myChoice][MyVariables.otherChoice];
                        MyVariables.myTotal+=myPayoff;
                        var per = document.createElement('div');
                        per.className = 'myPayoff';
                        per.id = 'id_myPayoff_' + p.toFixed(0);
                        per.innerHTML = myPayoff.toFixed(0);
                        {#per.style.backgroundColor = 'var(--D-color)';#}
                        per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                        document.getElementById("id_innerbox").appendChild(per);


                        //Others Payoff
                        var otherPayoff = MyVariables.payoffMatrix[MyVariables.otherChoice][MyVariables.myChoice];
                        MyVariables.otherTotal+=otherPayoff;
                        var per = document.createElement('div');
                        per.className = 'otherPayoff';
                        per.id = 'id_otherPayoff_' + p.toFixed(0);
                        per.innerHTML = otherPayoff.toFixed(0);
                        {#per.style.backgroundColor = 'var(--D-color)';#}
                        per.style.left = (50 * (1 - 1)).toFixed(0) + "px";
                        document.getElementById("id_innerbox").appendChild(per);

                        show("diceRollButton");
                        enableButton("diceRollButton");

                    }
                }
            }



        }


        function highlightRow(tabId,rowNum){

            hide("matchSummary");
            if(tabId=='tabA') {
                MyVariables.chosen1 = rowNum;

                updateText('myPlan','Plan #'+rowNum.toFixed(0));

                //Check if table exists
                var table = document.getElementById('tabA');
                for (var i = 1, row; row = table.rows[i]; i++) {
                    //iterate through rows
                    //rows would be accessed using the "row" variable assigned in the for loop
                        row.style.border = "none";
                        row.style.backgroundColor = "white";
                        var col = row.cells[2];
                        col.style.backgroundColor = "white";
                }

                var row = table.rows[rowNum];
                var col = row.cells[2];
                col.style.backgroundColor = "#c5f7bb";


            }else{
                MyVariables.chosen2 = rowNum;
                updateText('otherPlan','Plan #'+rowNum.toFixed(0));

                //Check if table exists
                var table = document.getElementById('tabA');
                for (var i = 1, row; row = table.rows[i]; i++) {
                    //iterate through rows
                    //rows would be accessed using the "row" variable assigned in the for loop
                        row.style.border = "none";
                        row.style.backgroundColor = "white";
                        var col = row.cells[3];
                        col.style.backgroundColor = "white";
                }

                var row = table.rows[rowNum];
                var col = row.cells[3];
                col.style.backgroundColor = "#c5f7bb";
            }

            console.log(MyVariables);



            {#if(MyVariables.chosen1>=0){#}
            {#    showText("id_myPlan","My Plan: #"+MyVariables.chosen1.toString())#}
            {#}#}
            {##}
            {#if(MyVariables.chosen2>=0){#}
            {#    showText("id_otherPlan","Other's Plan: #"+MyVariables.chosen2.toString())#}
            {#}#}

            if(MyVariables.chosen1>=0 && MyVariables.chosen2>=0){
                show("SimulateButton");
                show("id_outerbox");
            }
        }

        function setDisabled() {

            console.log("setDisabled-------");
            enableButton("SimulateButton");
            if(MyVariables.period>11) {
                enableScroll("id_innerbox");
            }
            for(var i=1;i<=10;i++){
                enableButton("tab1_"+i.toFixed(0));
                enableButton("tab2_"+i.toFixed(0));
            }
            show("matchSummary");
        }

        function simulateGame(){

            resetGame();
            disableScroll("id_innerbox");
            disableButton("SimulateButton");
            for(var i=1;i<=10;i++){
                disableButton("tab1_"+i.toFixed(0));
                disableButton("tab2_"+i.toFixed(0));
            }
            hide("matchSummary");


            while(Math.random()<.75 || MyVariables.period==0) {
                //Period element
                MyVariables.period += 1;

            }
            {#MyVariables.period=15;#}

            var res=playStrategies(MyVariables.period);
            console.log("res:",res);
            var myChoices=res[0];
            var otherChoices=res[1];
            var pays = getPayoffs(myChoices,otherChoices);
            var pay1 = pays[0];
            var pay2 = pays[1];

            updateText("summaryRounds",MyVariables.period.toFixed(0));
            updateText("summaryMyPayoff",pay1.reduce(getSum).toFixed(0));
            updateText("summaryOtherPayoff",pay2.reduce(getSum).toFixed(0));
            window.setTimeout(setDisabled, 1000*MyVariables.period);

            console.log("MyVariables.period:",MyVariables.period);
            for(var p=MyVariables.period;p>=1;p--){

                console.log("myChoices:",myChoices,"p=",p);
                showOnePeriod(p,MyVariables.period,myChoices[p-1],otherChoices[p-1],pay1[p-1],pay2[p-1])
            }
        }

        function playStrategies(periods) {

            console.log("playStrategies for ",periods," periods");
            var p1 = new Array(periods);
            var p2 = new Array(periods);

            var hist1 = [];
            var hist2 = [];

            for (var per = 0; per < periods; per++) {

                if (MyVariables.chosen1 == 1) {
                    var temp_hist1=hist1.concat(allc(hist2));
                } else if (MyVariables.chosen1 == 2) {
                    var temp_hist1=hist1.concat(alld(hist2))
                } else if (MyVariables.chosen1 == 3) {
                    var temp_hist1=hist1.concat(tft(hist2))
                } else if (MyVariables.chosen1 == 4) {
                    var temp_hist1=hist1.concat(grim(hist2))
                } else if (MyVariables.chosen1 == 5) {
                    var temp_hist1=hist1.concat(stft(hist2))
                } else if (MyVariables.chosen1 == 6) {
                    var temp_hist1=hist1.concat(sgrim(hist2))
                } else if (MyVariables.chosen1 == 7) {
                    var temp_hist1=hist1.concat(grim2(hist2))
                } else if (MyVariables.chosen1 == 8) {
                    var temp_hist1=hist1.concat(tf2t(hist2))
                } else if (MyVariables.chosen1 == 9) {
                    var temp_hist1=hist1.concat(two_tft(hist2))
                } else {
                    var temp_hist1=hist1.concat([Math.round(Math.random())])
                }

                if (MyVariables.chosen2 == 1) {
                    var temp_hist2=hist2.concat(allc(hist1))
                } else if (MyVariables.chosen2 == 2) {
                    var temp_hist2=hist2.concat(alld(hist1))
                }else if (MyVariables.chosen2 == 3) {
                    var temp_hist2=hist2.concat(tft(hist1))
                }else if (MyVariables.chosen2 == 4) {
                    var temp_hist2=hist2.concat(grim(hist1))
                }else if (MyVariables.chosen2 == 5) {
                    var temp_hist2=hist2.concat(stft(hist1))
                }else if (MyVariables.chosen2 == 6) {
                    var temp_hist2=hist2.concat(sgrim(hist1))
                } else if (MyVariables.chosen2 == 7) {
                    var temp_hist2=hist2.concat(grim2(hist1))
                } else if (MyVariables.chosen2 == 8) {
                    var temp_hist2=hist2.concat(tf2t(hist1))
                } else if (MyVariables.chosen2 == 9) {
                    var temp_hist2=hist2.concat(two_tft(hist1))
                } else {
                    var temp_hist2=hist2.concat([Math.round(Math.random())])
                }

                hist1=temp_hist1;
                hist2=temp_hist2;

            }

            return [hist1,hist2];
        }

        function getPayoffs(hist1,hist2){

            var pay1 = new Array(hist1.length);
            var pay2 = new Array(hist2.length);

            for(var p=0; p<hist1.length;p++){
                pay1[p]=MyVariables.payoffMatrix[hist1[p]][hist2[p]];
                pay2[p]=MyVariables.payoffMatrix[hist2[p]][hist1[p]];
            }

            return [pay1,pay2]
        }


        function getSum(total, num) {
            return total + num;
        }

        function check2Dinarow(hist) {
            if(hist.length<2){
                return false;
            } else {
                for(var p=1;p<hist.length;p++) {
                    if(hist[p]==1 && hist[p-1]==1){return true;}
                }
                return false;
            }
        }

        function check2Dinarowprevious(hist) {
            if(hist.length<2){
                return false;
            } else {
                if(hist[hist.length-1]==1 && hist[hist.length-2]==1){return true;}
                return false;
            }
        }

        function check1Dintwoprevious(hist) {
            if(hist.length<2){
                return false;
            } else {
                if(hist[hist.length-1]==1 || hist[hist.length-2]==1){return true;}
                return false;
            }
        }

        function allc(hist){
            return [0];
        }

        function alld(hist){
            return [1];
        }

        function tft(hist){
            if (hist.length==0){return [0];}else{return [hist[hist.length-1]];}
        }

        function grim(hist){
            if (hist.length==0){return [0];
            }else {
                if (hist.reduce(getSum) == 0) {
                    return [0];
                } else {
                    return [1];
                }
            }
        }

        function stft(hist){
            if (hist.length==0){return [1];}else{return [hist[hist.length-1]];}
        }

        function sgrim(hist){
            if (hist.length==0){return [1];
            }else {
                if (hist.reduce(getSum) == 0) {
                    return [0];
                } else {
                    return [1];
                }
            }
        }

        function grim2(hist){
            if (hist.length==0){return [0];
            } else {
                if(hist.length==1){return [0];
                } else {
                    if (check2Dinarow(hist)) {
                        return [1];
                    } else {
                        return [0];
                    }
                }
            }
        }

        function tf2t(hist){
            if (hist.length==0){return [0];
            } else {
                if(hist.length==1){return [0];
                } else {
                    if (check2Dinarowprevious(hist)) {
                        return [1];
                    } else {
                        return [0];
                    }
                }
            }
        }

        function two_tft(hist){
            if (hist.length==0){return [0];
            } else {
                if(hist.length==1){return [hist[hist.length-1]];
                } else {
                    if (check1Dintwoprevious(hist)) {
                        return [1];
                    } else {
                        return [0];
                    }
                }
            }
        }


        function showOnePeriod(p,periods,myChoice,otherChoice,myPayoff,otherPayoff) {
            //Period
            var per = document.createElement('div');
            per.className = 'period';
            per.id = 'id_period_' + p.toFixed(0);
            per.innerHTML = p.toFixed(0);
            per.style.backgroundColor = 'white';
            per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity=0;
            per.style.animationDelay = (p).toFixed(1)+'s';
            per.style.animationFillMode='forwards';


            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: 1
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);



            var options = ['A','B'];
            var colOptions = ['var(--C-color)','var(--D-color)'];
            console.log("options=",options,"myChoice=",myChoice,"options[myChoice]=",options[myChoice])

            //My Choice
            var per = document.createElement('div');
            per.className = 'myChoice';
            per.id = 'id_myChoice_' + p.toFixed(0);
            per.innerHTML = options[myChoice];
            per.style.backgroundColor = colOptions[myChoice];
            per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity=0;
            per.style.animationDelay = (p).toFixed(1)+'s';
            per.style.animationFillMode='forwards';


            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: 1
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1,

                timingFunction: 'linear'
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);

            //Other's Choice
            var per = document.createElement('div');
            per.className = 'otherChoice';
            per.id = 'id_otherChoice_' + p.toFixed(0);
            per.innerHTML = options[otherChoice];
            per.style.backgroundColor = colOptions[otherChoice];
            per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity=0;
            per.style.animationDelay = (p).toFixed(1)+'s';
            per.style.animationFillMode='forwards';


            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: 1
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);

            //my Payoff
            var per = document.createElement('div');
            per.className = 'myPayoff';
            per.id = 'id_myPayoff_' + p.toFixed(0);
            per.innerHTML = myPayoff.toFixed(0);
            {#per.style.backgroundColor = 'var(--D-color)';#}
           per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity=0;
            per.style.animationDelay = (p).toFixed(1)+'s';
            per.style.animationFillMode='forwards';


            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: 1
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);


             //Others Payoff
            var per = document.createElement('div');
            per.className = 'otherPayoff';
            per.id = 'id_otherPayoff_' + p.toFixed(0);
            per.innerHTML = otherPayoff.toFixed(0);
            {#per.style.backgroundColor = 'var(--D-color)';#}
           per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity=0;
            per.style.animationDelay = (p).toFixed(1)+'s';
            per.style.animationFillMode='forwards';


            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: .5
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);


            //Random Number

            var per = document.createElement('div');
            per.className = 'randomNum';
            per.id = 'id_randomNum_' + p.toFixed(0);

            {#per.style.backgroundColor = 'var(--D-color)';#}
            per.style.left = (50 * (periods - p)).toFixed(0) + "px";
            per.style.opacity = 0;
            per.style.animationDelay = (p).toFixed(1) + 's';
            per.style.animationFillMode = 'forwards';

            var randomItem = 4;
            if(p<periods) {
                var randomItem = MyVariables.myNumbers[Math.floor(Math.random() * MyVariables.myNumbers.length)];
                per.innerHTML = randomItem;
            }else{
                per.style.fontWeight="bold";
                per.style.color="red";
                per.innerHTML = 4;
                per.style.opacity = 0;
            }

            per.keyframes = [{
                transform: "translateX(-" + (50 * (periods - p)).toFixed(0) + "px)",
                opacity: 0
              }, {
                transform: "translateX(" + (0).toFixed(0) + "px)",
                opacity: 0
              }];

            per.animProps = {
              duration: 1000*(periods-p),
              delay:1000*p,
              iterations: 1
            };

            per.animate(per.keyframes, per.animProps);
            document.getElementById("id_innerbox").appendChild(per);
        }

        function resetGame(){
            var elems = ['id_period_','id_myChoice_','id_otherChoice_','id_myPayoff_','id_otherPayoff_','id_randomNum_'];
            for( var p=1; p<=MyVariables.period; p++) {
                for ( var i=0; i<elems.length; i++ ){
                    var elemName = elems[i] + p.toFixed(0);
                    var elementExists = document.getElementById(elemName);
                    if (elementExists != null) {
                        deleteElement(elemName);
                    }
                }
            }
            MyVariables.period=0;
            hide("scrollLabel");
            disableScroll("id_innerbox");

        }

        function showText(target,someText) {
            var x = document.getElementById(target);
            x.style.display = "block";
            x.innerHTML=someText;
        }

        function updateText(target,someText) {
            var x = document.getElementById(target);
            x.innerHTML=someText;
        }

        function hide(target) {
            var x = document.getElementById(target);
            x.style.display = "none";
        }

        function disableButton(target){
            var x = document.getElementById(target);
            x.style.borderColor = "white";
            x.style.pointerEvents="none";
        }

        function enableButton(target){
           var x = document.getElementById(target);
           x.style.borderColor = "green";
           x.style.pointerEvents="all";
        }

        function disableScroll(target){
            var x = document.getElementById(target);
            x.style.overflowX='hidden';
        }


        function enableScroll(target){
            var x = document.getElementById(target);
            x.style.overflowX='scroll';
        }

        function show(target) {
            var x = document.getElementById(target);
            x.style.display = "block";
        }

        function showInline(target) {
            var x = document.getElementById(target);
            x.style.display = "inline-block";
        }

        function showFlex(target) {
            var x = document.getElementById(target);
            x.style.display = "flex";
        }

        function deleteElement(elementID){
              var element = document.getElementById(elementID);
              element.parentNode.removeChild(element);
         }

</script>

{% endblock %}